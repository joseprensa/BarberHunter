<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Barber X - Barber Shop Template</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="Free Website Template" name="keywords" />
    <meta content="Free Website Template" name="description" />

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon" />

    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- CSS Libraries -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="lib/animate/animate.min.css" rel="stylesheet" />
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet" />

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet" />
  </head>
  <style>
    /* DropDown */
    /* Add this CSS to your existing styles */
  </style>
  <body>
    <!-- Top Bar Start -->
    <div class="top-bar d-none d-md-block">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-6">
            <div class="top-bar-left">
              <div class="text">
                <h2>9:00AM - 5:00PM</h2>
                <p>Opening Hour Mon - Fri</p>
              </div>
              <div class="text">
                <h2>+123 456 7890</h2>
                <p>Call Us For Appointment</p>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="top-bar-right">
              <div class="social">
                <a href="Barber/barberLogin.html" id="barber_login">
                  <button
                    class="btn btn-primary"
                    style="
                      background: #1d2434;
                      border: none;
                      text-overflow: ellipsis;
                      font-size: 12px;
                    "
                  >
                    Barber As Login
                  </button>
                </a>
              </div>
              <div class="social">
                <a href=""><i class="fab fa-facebook-f"></i></a>
                <a href=""><i class="fab fa-whatsapp"></i></a>
                <a href=""><i class="fab fa-instagram"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Top Bar End -->

    <!-- Nav Bar Start -->
    <div class="navbar navbar-expand-lg bg-dark navbar-dark">
      <div class="container-fluid">
        <a href="index.html" class="navbar-brand">
          <img src="img/simbolo-blanco.png" alt="" />
          <span class="brand-text">BARBER <span>HUNTER</span></span>
        </a>

        <button
          type="button"
          class="navbar-toggler"
          data-toggle="collapse"
          data-target="#navbarCollapse"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="collapse navbar-collapse justify-content-between"
          id="navbarCollapse"
        >
          <div class="navbar-nav ml-auto">
            <a href="index.html" class="nav-item nav-link active">Home</a>
            <a href="#about" class="nav-item nav-link">About</a>
            <a href="#service" class="nav-item nav-link">Service</a>
            <a href="#gallery" class="nav-item nav-link">Gallery</a>
            <a
              href="Barber/barberLogin.html"
              id="barber_login"
              class="nav-item nav-link"
            >
              Barber As Login
            </a>
            <a
              href="./CustomerRegister.html"
              id="signupLink"
              class="nav-item nav-link"
              >SignUp</a
            >
            <a
              href="./CustomerLogin.html"
              id="loginLink"
              class="nav-item nav-link"
              >Login</a
            >
            <div class="dropdown show">
              <a
                class="nav-item nav-link dropdown-toggle"
                href="#"
                role="button"
                id="userDropdown"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="fas fa-user"></i>
                <span id="userName"></span>
              </a>
              <div class="dropdown-menu" aria-labelledby="userDropdown">
                <a href="./profile.html" class="dropdown-item" role="button"
                  >Profile</a
                >
                <a
                  href="./CustomerAppointmentTable.html"
                  class="dropdown-item"
                  role="button"
                  >Appointment</a
                >

                <a
                  href="#"
                  id="logoutButton"
                  class="dropdown-item"
                  role="button"
                  >Logout</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Nav Bar End -->

    <!-- Hero Start -->
    <div class="hero">
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm-12 col-md-6">
            <div class="hero-text">
              <h1>YOU'RE GOING TO BOOK ME.</h1>
              <p>
                Hello, my name is <b>Jose Prensa</b> I'm a barber at Dream Team
                Barbershop.
              </p>
              <a
                class="btn"
                href="./appointment.html"
                id="selectBarberBtn"
                data-toggle="modal"
                data-target="#barberModal"
                >Appointment</a
              >
            </div>
          </div>
          <div class="col-sm-12 col-md-6 d-none d-md-block">
            <div class="hero-image">
              <img src="img/about.jpg" alt="Hero Image" />
            </div>
          </div>
        </div>
      </div>
      <!-- Add this button where the customer can open the modal -->
    </div>

    <!-- The Modal -->
    <div
      class="modal fade"
      id="barberModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="barberModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="barberModalLabel">
              Barber Nearby Location
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- Select box for barber selection -->
            <select id="selectBarber" class="form-control">
              <option value="select">Select the barber</option>
              <!-- Barber options will be dynamically populated here -->
            </select>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
            <!-- <button
              type="button"
              class="btn btn-primary"
              id="selectBarberBtnModal"
            >
              OK
            </button> -->
          </div>
        </div>
      </div>
    </div>
    <!-- Hero End -->

    <!-- About Start -->
    <div class="about" id="about">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-5 col-md-6">
            <div class="about-img">
              <img src="img/about.jpg" alt="Image" />
            </div>
          </div>
          <div class="col-lg-7 col-md-6">
            <div class="section-header text-left">
              <p>Learn About Us</p>
              <h2>10 Years Experience</h2>
            </div>
            <div class="about-text">
              <p>
                I am a passionate barber with over 10 years of experience in the
                trade. I love to transform the look of my clients and give them
                a haircut that makes them feel confident and fabulous. I strive
                to stay up to date with the latest trends in haircuts and
                styles, and I am always willing to listen to the needs and
                desires of my clients in order to provide them with the best
                possible service. My barbershop is a cozy and relaxed place
                where you can sit back, relax and enjoy a quality haircut. I
                offer a wide range of services, from classic cuts to more modern
                and elaborate styles. I make sure to work with precision and
                attention to detail to ensure that every client leaves my
                barbershop with a haircut they love. If you are looking for a
                reliable and experienced barber, look no further. Book your
                appointment with me today and let me show you why I am the
                perfect barber for you.
              </p>
              <a class="btn" href="#about">Learn More</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- About End -->

    <!-- Service Start -->
    <div class="service" id="service">
      <div class="container">
        <div class="section-header text-center">
          <p>Our Salon Services</p>
          <h2>Barber Services for You</h2>
        </div>
        <div class="row">
          <div class="col-lg-4 col-md-6">
            <div class="service-item">
              <div class="service-img">
                <img src="img/hairstyle.jpg" alt="Image" />
              </div>
              <h3>Hair Cut</h3>
              <p>
                Lorem ipsum dolor sit amet elit. Phasellus nec pretium mi.
                Curabitur facilisis ornare velit non
              </p>
              <a class="btn" href="">Learn More</a>
            </div>
          </div>
          <div class="col-lg-4 col-md-6">
            <div class="service-item">
              <div class="service-img">
                <img src="img/beard1.jpg" alt="Image" />
              </div>
              <h3>Beard Style</h3>
              <p>
                Lorem ipsum dolor sit amet elit. Phasellus nec pretium mi.
                Curabitur facilisis ornare velit non
              </p>
              <a class="btn" href="">Learn More</a>
            </div>
          </div>
          <div class="col-lg-4 col-md-6">
            <div class="service-item">
              <div class="service-img">
                <img src="img/color.jpg" alt="Image" />
              </div>
              <h3>Color & Wash</h3>
              <p>
                Lorem ipsum dolor sit amet elit. Phasellus nec pretium mi.
                Curabitur facilisis ornare velit non
              </p>
              <a class="btn" href="">Learn More</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Service End -->

    <!-- Portfolio Start -->
    <div class="portfolio" id="gallery">
      <div class="container">
        <div class="section-header text-center">
          <p>Barber Image Gallery</p>
          <h2>Some Images From Our Barber Gallery</h2>
        </div>
        <div class="row">
          <div class="col-12">
            <ul id="portfolio-flters">
              <li data-filter="*" class="filter-active">All</li>
              <li data-filter=".first">Hair Cut</li>
              <li data-filter=".second">Beard Style</li>
              <li data-filter=".third">Color & Wash</li>
            </ul>
          </div>
        </div>
        <div class="row portfolio-container">
          <div class="col-lg-4 col-md-6 col-sm-12 portfolio-item first">
            <div class="portfolio-wrap">
              <a href="img/hairstyle.jpg" data-lightbox="portfolio">
                <img src="img/hairstyle.jpg" alt="Portfolio Image" />
              </a>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 col-sm-12 portfolio-item second">
            <div class="portfolio-wrap">
              <a href="img/beard2.jpg" data-lightbox="portfolio">
                <img src="img/beard2.jpg" alt="Portfolio Image" />
              </a>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 col-sm-12 portfolio-item third">
            <div class="portfolio-wrap">
              <a href="img/color2.jpg" data-lightbox="portfolio">
                <img src="img/color2.jpg" alt="Portfolio Image" />
              </a>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 col-sm-12 portfolio-item first">
            <div class="portfolio-wrap">
              <a href="img/portfolio-4.jpg" data-lightbox="portfolio">
                <img src="img/portfolio-4.jpg" alt="Portfolio Image" />
              </a>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 col-sm-12 portfolio-item second">
            <div class="portfolio-wrap">
              <a href="img/beard3.jpg" data-lightbox="portfolio">
                <img src="img/beard3.jpg" alt="Portfolio Image" />
              </a>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 col-sm-12 portfolio-item third">
            <div class="portfolio-wrap">
              <a href="img/color3.jpg" data-lightbox="portfolio">
                <img src="img/color3.jpg" alt="Portfolio Image" />
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Portfolio Start -->

    <!-- Footer Start -->
    <div class="footer">
      <div class="container">
        <div class="row">
          <div class="col-lg-7">
            <div class="row">
              <div class="col-md-6">
                <div class="footer-contact">
                  <h2>Barber Address</h2>
                  <p>
                    <i class="fa fa-map-marker-alt"></i>123 Street, New York,
                    USA
                  </p>
                  <p><i class="fa fa-phone-alt"></i>+012 345 67890</p>
                  <p><i class="fa fa-envelope"></i>barber@example.com</p>
                  <div class="footer-social">
                    <a href=""><i class="fab fa-facebook-f"></i></a>
                    <a href=""><i class="fab fa-instagram"></i></a>
                    <a href=""><i class="fab fa-whatsapp"></i></a>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="footer-link">
                  <h2>Useful Links</h2>
                  <p>Home</p>
                  <p>About</p>
                  <p>Service</p>
                  <p>Gallery</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-5">
            <div class="footer-newsletter">
              <h2>GET OFFERS</h2>
              <div class="form">
                <input class="form-control" placeholder="ENTER YOUR EMAIL" />
              </div>
              <button class="btn">SUBSCRIBE</button>
            </div>
          </div>
        </div>
      </div>
      <div class="container copyright">
        <div class="row">
          <div class="col-md-6">
            <p>
              &copy;
              <a href="#"
                ><img src="img/simbolo-negro.png" alt="" width="60px" />Barber
                Hunter</a
              >, All Right Reserved.
            </p>
          </div>
          <div class="col-md-6">
            <p>
              Designed By
              <a href="#">
                <img src="img/simbolo-negro.png" alt="" width="50px" /><span
                  >Barber Hunter</span
                >
              </a>
            </p>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer End -->

    <a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

    <!--   ==========================      JAVASCRIPT CODE IN SCRIPT TAG      ==========================    -->
    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/isotope/isotope.pkgd.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        push,
        set,
        child,
        get,
      } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";
      import {
        getAuth,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyD0yIZdTSsU7gFDGnNCLTGv9DuLqbzsX_0",
        authDomain: "barber-hunter-12291.firebaseapp.com",
        databaseURL: "https://barber-hunter-12291-default-rtdb.firebaseio.com",
        projectId: "barber-hunter-12291",
        storageBucket: "barber-hunter-12291.appspot.com",
        messagingSenderId: "454962485770",
        appId: "1:454962485770:web:e3a919cb39cab044e81df3",
        measurementId: "G-W027N9XFME",
      };

      const app = initializeApp(firebaseConfig);

      // Reference to the Firebase Realtime Database
      const db = getDatabase();
      const customerAuth = getAuth();
      const barberAuth = getAuth();

      // User Authentication State Change
      const userDropdownContainer = document.querySelector(".dropdown.show");

      customerAuth.onAuthStateChanged((user) => {
        const userNameElement = document.getElementById("userName");
        const logoutButton = document.getElementById("logoutButton");
        const selectBarber = document.getElementById("selectBarber");
        const signupLink = document.getElementById("signupLink");
        const loginLink = document.getElementById("loginLink");

        if (user) {
          // User is logged in
          userNameElement.textContent = "Loading";
          const customerDataRef = ref(db, `customers/${user.uid}`);
          get(customerDataRef).then((snapshot) => {
            const customerData = snapshot.val();
            if (customerData) {
              userNameElement.textContent = customerData.name;
              selectBarber.style.display = "block";
              signupLink.style.display = "none";
              loginLink.style.display = "none";
              userDropdownContainer.style.display = "block"; // Show dropdown container
              $(userDropdownContainer).find(".dropdown-toggle").dropdown();
            }
          });
        } else {
          // User is not logged in
          userNameElement.textContent = "";
          selectBarber.style.display = "none";
          signupLink.style.display = "block";
          loginLink.style.display = "block";
          userDropdownContainer.style.display = "none"; // Hide dropdown container
        }
      });

      // Logout
      const logoutButton = document.getElementById("logoutButton");
      logoutButton.addEventListener("click", async (event) => {
        event.stopPropagation();
        try {
          await signOut(customerAuth);
        } catch (error) {
          // console.log("Logout failed: " + error.message);
        }
      });

      const barberLoginButton = document.getElementById("barber_login");
      barberLoginButton.addEventListener("click", async (e) => {
        e.preventDefault();

        // Check if the customer is authenticated
        if (customerAuth.currentUser) {
          try {
            await signOut(customerAuth); // Logout the customer
            // Redirect to the Barber Login page
            window.location.href = "Barber/barberLogin.html";
          } catch (error) {
            // console.error("Logout failed: " + error.message);
          }
        } else {
          // If the customer is not authenticated, simply navigate to the Barber Login page
          window.location.href = "Barber/barberLogin.html";
        }
      });

      const appointmentButton = document.querySelector(".hero-text a.btn");

      appointmentButton.addEventListener("click", (event) => {
        // Check if the user is authenticated
        if (!customerAuth.currentUser) {
          event.preventDefault(); // Prevent the default behavior of the link
          alert("Please authenticate first!"); // Show authentication alert
          window.location.href = "CustomerRegister.html";
        } else {
          // Open the modal
          $("#barberModal").modal("show");
          // Set the initial value of the select box to "select"
          selectBarber.value = "select";
        }
      });

      // Get a reference to the select box for barber selection
      const selectBarber = document.getElementById("selectBarber");
      const barbersRef = ref(db, "barbers");
      let barbers = [];

      get(barbersRef).then((snapshot) => {
        snapshot.forEach((barberSnapshot) => {
          const uid = barberSnapshot.key; // This is the UID
          const barber = barberSnapshot.val();
          barber.uid = uid; // Store the UID in the barber object
          barbers.push(barber);

          const option = document.createElement("option");
          option.setAttribute("value", uid); // Use UID as the value
          option.textContent = `${barber.name} - ${barber.address}`;
          selectBarber.appendChild(option);
        });

        const storedBarberId = localStorage.getItem("selectedBarber");
        if (storedBarberId) {
          selectBarber.value = storedBarberId;
        }

        selectBarber.addEventListener("change", handleBarberSelection);
      });

      function handleBarberSelection() {
        const selectedOption = selectBarber.options[selectBarber.selectedIndex];
        const selectedBarberId = selectedOption.value;

        // Find the selected barber's details using the UID
        const selectedBarberDetails = barbers.find(
          (barber) => barber.uid === selectedBarberId
        );

        localStorage.setItem(
          "selectedBarber",
          JSON.stringify(selectedBarberDetails)
        );
        window.location.href = "appointment.html";
      }
    </script>
  </body>
</html>
